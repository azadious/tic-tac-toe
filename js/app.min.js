function AbstractSideTurn(){}function BoardFactory(element){this.target=element,this.humanTurn=new HumanTurn,this.computerTurn=new ComputerTurn}function ComputerTurn(){AbstractSideTurn.call(this)}function HumanTurn(){AbstractSideTurn.call(this)}AbstractSideTurn.prototype.marker="",AbstractSideTurn.prototype.side="",AbstractSideTurn.prototype.sideName="",AbstractSideTurn.prototype.checkWinner=function(pointer,side){return pointer[0]==side&&pointer[1]==side&&pointer[2]==side?this.callbackWinnerAction(side):pointer[3]==side&&pointer[4]==side&&pointer[5]==side?this.callbackWinnerAction(side):pointer[6]==side&&pointer[7]==side&&pointer[8]==side?this.callbackWinnerAction(side):pointer[0]==side&&pointer[3]==side&&pointer[6]==side?this.callbackWinnerAction(side):pointer[1]==side&&pointer[4]==side&&pointer[7]==side?this.callbackWinnerAction(side):pointer[2]==side&&pointer[5]==side&&pointer[8]==side?this.callbackWinnerAction(side):pointer[0]==side&&pointer[4]==side&&pointer[8]==side?this.callbackWinnerAction(side):pointer[2]==side&&pointer[4]==side&&pointer[6]==side?this.callbackWinnerAction(side):!1},AbstractSideTurn.prototype.drawMarker=function(el){el.html(this.marker)},AbstractSideTurn.prototype.setPointer=function(pointer,index){0==pointer[index]?pointer[index]=this.side:alert("this block not null")},AbstractSideTurn.prototype.callbackWinnerAction=function(){return!0},BoardFactory.prototype.humanTurn,BoardFactory.prototype.computerTurn,BoardFactory.prototype.target="",BoardFactory.prototype.isProcess=0,BoardFactory.prototype.turnNumber=0,BoardFactory.prototype.pointer=[0,0,0,0,0,0,0,0,0],BoardFactory.prototype.markPointer=function(el){var indexPointer=el.index("td");if(0==this.pointer[indexPointer]&&0==this.isProcess){if(this.isProcess=1,this.pointer[indexPointer]=this.humanTurn.side,this.humanTurn.drawMarker(el),result=this.humanTurn.checkWinner(this.pointer,this.humanTurn.side))return alert(this.humanTurn.sideName+"Win"),void this.resetGame();if(this.turnNumber=this.turnNumber+1,computerMarkerIndex=this.computerTurn.chooseBlock(this.pointer,this.turnNumber),this.pointer[computerMarkerIndex]=this.computerTurn.side,this.computerTurn.drawMarker($("td").eq(computerMarkerIndex)),result=this.computerTurn.checkWinner(this.pointer,this.computerTurn.side))return alert(this.computerTurn.sideName+"Win"),void this.resetGame();this.turnNumber=this.turnNumber+1,this.isProcess=0}else alert("Bot say: don't cheat :p")},BoardFactory.prototype.resetGame=function(){this.pointer=[0,0,0,0,0,0,0,0,0],this.isProcess=0,this.turnNumber=0,$("td").html("")},ComputerTurn.prototype=new AbstractSideTurn,ComputerTurn.prototype.constructor=ComputerTurn,ComputerTurn.prototype.sideName="Computer",ComputerTurn.prototype.side="c",ComputerTurn.prototype.marker='<i class="fa fa-times"></i>',ComputerTurn.prototype.chooseBlock=function(pointer,turnNumber){var minimaxIndex={win:null,lose:null},side=this.side,pointerCount=pointer.length;if(!(parseInt(turnNumber)>2))return randomIndex=this.random(pointer);for(var i=0;pointerCount>i;i++)if(cPointer=pointer.slice(0),0==cPointer[i]){cPointer[i]=side;var isComputerWin=this.checkWinner(cPointer,side);1==isComputerWin&&(minimaxIndex.win=i)}side="h";for(var i=0;pointerCount>i;i++)if(hPointer=pointer.slice(0),0==hPointer[i]){hPointer[i]=side;var isHumanWin=this.checkWinner(hPointer,side);console.log(isHumanWin+" "+i),1==isHumanWin&&(minimaxIndex.lose=i)}return null!=minimaxIndex.win?minimaxIndex.win:null!=minimaxIndex.lose?minimaxIndex.lose:null==minimaxIndex.win&&null==minimaxIndex.lose?randomIndex=this.random(pointer):void 0},ComputerTurn.prototype.random=function(pointer){for(var i=0;i<pointer.length;i++)if(indexPointer=_.random(0,pointer.length),0==pointer[indexPointer])return indexPointer},ComputerTurn.prototype.genPointer=function(pointer,index,side){return 0==pointer[index]?(pointer[index]=side,pointer):!1},HumanTurn.prototype=new AbstractSideTurn,HumanTurn.prototype.constructor=HumanTurn,HumanTurn.prototype.sideName="Human",HumanTurn.prototype.side="h",HumanTurn.prototype.marker='<i class="fa fa-circle-o"></i>';